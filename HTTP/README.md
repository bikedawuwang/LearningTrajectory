# HTTP 看完还不会，你打死我！

## HTTP基本概念

### HTTP是什么？

HTTP就是超文本传输协议，也就是HyperText Transfer Protocol。

HTTP 可以拆成三个部分 超文本、传输、协议。

### 超文本

HTTP传输的是超文本，那么什么是超文本呢？

我们先来理解文本，在http中的文本包含了最基本文字，现在还涵盖了图片、视频、音乐、压缩包等。。。

超文本的意思就是超越了文本本身，它本身是纯文本，但是却包含了图片、视频、音乐等信息。

最关键的是有超链接，可以让我们通过一个超文本跳跃到另一个超文本。

### 协议

协议就是字面意思，与生活中的协议一样。

针对http协议，我们可以理解为：它使用计算机能够理解的语言确立了一种计算机之间交流通信的规范(两个以上的参与者)，以及相关的各种控制和错误处理方式(行为约定和规范)。

### 传输

传输我们可以理解为快递公司运送货物，我们需要把一件物品从A点运送到B点，或者从B点运送到A点。

这也解释了 http 的协议是一个双向协议。

我们在发起http请求时，浏览器是请求方A，百度就是应答方B。双方约定用http来通信，于是浏览器把请求发给了网站，网站又把一些数据传输回了浏览器。最后由浏览器进行渲染，也就有了我们能看到的页面。

数据虽然在A与B之间传输，但是正如快递一样，传输的过程中可以存在中转站，如果北京快递到三亚，可能就会存在海口中转站，所以http的传输也可以是 A - N - M - B。

## 状态码

既然http有协议（行为约定和规范），所以也规范了一些状态码，用来告知你当前状态。

### 1xx

1xx 类状态码属于提示信息，是协议处理中的一种状态，所以很少会用到。

### 2xx

2xx 类状态码表示服务器成功处理了客户端的请求，一般出现2xx类状态码都意味着这是好消息。

「200 OK」是最常见的成功状态码，表示一切正常。如果是非 HEAD 请求，服务器返回的响应头都会有 body 数据。

「204 No Content」也是常见的成功状态码，与 200 OK 基本相同，但响应头没有 body 数据。

「206 Partial Content」是应用于 HTTP 分块下载或断电续传，表示响应返回的 body 数据并不是资源的全部，而是其中的一部分，也是服务器处理成功的状态。

### 3xx

3xx类状态码表示客户端请求的资源发生了变动，需要客户端用新的url重新发送请求获取资源，也就是重定向。

「301 Moved Permanently」表示永久重定向，说明请求的资源已经不存在了，需改用新的 URL 再次访问。

「302 Found」表示临时重定向，说明请求的资源还在，但暂时需要用另一个 URL 来访问。

301 和 302 都会在响应头里使用字段 Location，指明后续要跳转的 URL，浏览器会自动重定向新的 URL。

「304 Not Modified」不具有跳转的含义，表示资源未修改，重定向已存在的缓冲文件，也称缓存重定向，用于缓存控制。



### 4xx

4xx类装填吗表示客户端发送的报文有误，服务器无法处理。

「400 Bad Request」表示客户端请求的报文有错误，但只是个笼统的错误。

「403 Forbidden」表示服务器禁止访问资源，并不是客户端的请求出错。

「404 Not Found」表示请求的资源在服务器上不存在或未找到，所以无法提供给客户端。

### 5xx

5xx类状态码表示客户端的请求报文正确，但是玩服务器内部处理发生了错误，属于服务器端的错误。

「500 Internal Server Error」与 400 类型，是个笼统通用的错误码，服务器发生了什么错误，我们并不知道。

「501 Not Implemented」表示客户端请求的功能还不支持，类似“即将开业，敬请期待”的意思。

「502 Bad Gateway」通常是服务器作为网关或代理时返回的错误码，表示服务器自身工作正常，访问后端服务器发生了错误。

「503 Service Unavailable」表示服务器当前很忙，暂时无法响应服务器，类似“网络服务正忙，请稍后重试”的意思。

## HTTP常见字段

### HOST

客服端发送请求时，用来指定服务器域名。

```
Host: www.a.com
```

有了 Host 字段就可以将请求发往同一台服务器上的不同网站。

### Content-Length

服务器在返回数据时，会有Content-Length字段，表明本次回应的数据长度。

```
Content-Length:1000
```

这条则是告诉浏览器，本次服务器回应的数据长度是1000个字节，后面的字节就属于下一个响应了。

### Connection

Connection 字段最常用于客户端要求服务器使用TCP持久链接，以便其他请求复用。

HTTP/1.1 版本的默认 连接都是持久连接，但为了兼容老版本的HTTP，需要指定Connection首部字段的值为Keep-Alive

```
Connection: keep-alive
```

一个可以复用的TCP连接就建立了，知道客户端或服务器主动关闭连接，但是，这不是一个标准字段。

### Content-Type

Content-Type字段用于服务器回应时，告诉客户端本次数据的格式是什么。

```
Content-Type: text/html;charset=utf-8
```

上面的类型表明，发送的是网页，网页编码为utf-8

客服端发送请求的时候，也可以用Accept字段声明自己可以接受哪些数据格式

```
Accept:*/*
```

上述代码中，客户端声明自己可以接受任何格式的数据。

### Content-Encoding

Content-Encoding 字段说明数据的压缩方法。表明服务器返回的数据使用了什么压缩格式

```
Content-Encoding: gzip
```

上面标示服务器返回的数据采用了gzip方式压缩，告知客户端要用此种方式解压。

客户端在请求时，可以用Accept-Encoding 字段说明自己可以接受哪些压缩方法。

```
Accept-Encoding: gzip,deflate
```

## GET与POST

GET与POST请求的区别？

### GET请求

GET方法的含义是请求从服务器获取资源，这个资源可以是静态的文本、页面、图片、视频等等。

比如，你访问bilibili， 浏览器就会发送GET请求给服务器，服务器就会返回页面所包含的文字信息与资源。

### POST请求

POST请求则刚好与GET相反，它向URI指定的资源提交数据，数据就放在报文的body里。

比如，你在bilibili留言，输入留言后点击提交，浏览器就会执行一次POST请求，把你的留言放进了报文body里，然后拼接好POST请求头，通过TCP协议发送给服务器。

### 安全性

GET与POST方法都是安全和幂等的么？

- 在HTTP协议里，所谓`安全`是指请求方法不会破坏服务器上的资源。
- 所谓的 幂等，意思是多次执行相同的操作，都是相同的。

那么很明显 GET请求是安全且幂等的，因为它是只读操作，无论操作多少次，服务器上的数据都是安全的，且每次结果都是相同的。  

POST因为是 新增或提交数据的操作，会修改服务器上的资源，所以并不安全，且多次提交数据就会创建多个资源，所以并不是幂等的。

## HTTP特性

### 1.简单

HTTP基本的保温格式就是 header + body 头部信息也是key-value简单文本的形式，易于理解，也降低了学习和使用的门槛

### 2.灵活和易于扩展

HTTP协议里的各类请求方法，URI/URL、状态码、头字段等每个组成要求都没有被固定死，都允许开发人员自定义和扩充。

同时HTTP由于是工作在应用层（OSI第七层），则它下层可以随意变化。

HTTPS也就是HTTP与TCP层之间增加了 SSL/TLS安全传输层，HTTP/3甚至把TCPP层换成了基于UDP的QUIC

### 3.应用广泛和跨平台



## HTTP的缺点

### 1.无状态

无状态的好处，因为服务器不会去记忆HTTP的状态，所以不需要额外的资源来记录状态信息，这能减少服务器的资源负担。

但是因为无状态，它在完成有关联性的操作时会很麻烦。

例如 登录 -> 添加购物车 -> 下单 -> 结算 -> 支付，这一系列操作都需要知道用户的身份才行。但是服务器并不知道这些请求时有关联的，所以每次都要对身份进行确认。

对于无状态的问题，解决方案有很多种，其中比较简单的方式采用 Cookie 技术。

cookie通过在请求和响应报文中写入cookie信息来控制客户端的状态。

相当于，在客户端在第一次请求后，服务器会下发一个装有客户信息的便利签，后续客户端请求服务器的时候，带上便利签，服务器就认得你了。



### 2.铭文传输双刃剑

明文意味着在传输过成中的信息，是很容易被阅读的。通过浏览器的控制台或者wireshark抓包都可以直接查看，这位我们调试带来了极大的便利。

但是正因为这样，http 的所有信息都暴露了出来，相当于信息裸奔，在传输的漫长过程中，信息的内容都毫无隐私可言，如果里面有你的私密信息，它们将很容易被其他人得到。

### 3. 不安全

HTTP比较严重的缺点就是不安全。

- 通信使用明文，内容可能会被窃听。比如账号信息容易泄露，你号就没了。
- 不验证通信方的身份，因此有可能遭遇伪装。比如，访问了假的淘宝网站，拼多多， 你钱就没了。
- 无法证明报文的完整性，所以有可能遭到篡改，比如网页上植入垃圾广告，视觉污染。你眼瞎了。

HTTP的安全问题，可以通过HTTPS解决，也就是通过因为SSL/TLS层。

## 长连接与短连接

早期的HTTP/1.1 提出了长连接通信方式，也叫持久连接。

这种方式的好处在于减少了TCP连接的重复简历和断开所造成的额外开销，减轻了服务器端的负载。

持久连接的特点是，只要任意一段没有明确提出断开连接，则始终保持TCP连接状态。  

## 管道网络传输

HTTP/1.1 采用了长连接的方式，这使得管道网络传输成为了可能。

即可在同一个TCP连接里面，客户端可以发起多个请求，只要第一个请求发出去了，不必等其回来，就可以发送第二个请求处刑曲，减少了整体的响应时间。

## 队头阻塞

请求 - 应答 模式加剧了http的性能问题。

因为当顺序发送的请求序列中的一个请求因为某种原因被阻塞时，在后面排队的请求也一同被阻塞了，会招致客户端一直请求不到数据，这也就是 队头阻塞。

## HTTP与HTTPS

- HTTP是超文本传输协议，信息是明文传输，存在安全风险问题。HTTPS则解决了HTTP不安全的缺陷，在TCP和HTTP网络层之间加入了SSL/TLS安全协议，使得报文能够加密传输。
- HTTP连接相对简单，TCP进行三次握手之后便可以进行HTTP的报文传输，而HTTPS在TCP三次握手之后，还需进行SSL/TLS的握手过成，才可以进行加密报文的传输。
- HTTP端口号是80 HTTPS端口号为443
- HTTPS协议需要向CA申请数字证书，来保证服务器的身份是可信的。

HTTPS解决了哪些问题

- 窃听风险，比如通信链路上可以获取通信内容，比如你号没了
- 篡改风险，比如强制植入垃圾广告，视觉污染。容易导致你眼瞎。
- 冒充风险，比如冒充购物网站，银行网站，你的钱就没了。

HTTPS在HTTP与TCP层之间加入了SSL/TLS协议

HTTPS可以解决上述风险

- 信息加密： 交互信息无法被窃取
- 校验机制：无法篡改通信内容
- 身份证书：证明该网站是真实的

可见只要自身不作恶，SSL/TLS 协议是能保证通信是安全的。 